/* eslint-disable no-console,import/no-extraneous-dependencies */
const fs = require('fs');
const gulp = require('gulp');
const cliPrint = require('./helper/cli-print');

const commonDir = fs.realpathSync(`${__dirname}'/../common`);
const definitionsDir = fs.realpathSync(`${__dirname}'/../definitions`);

exports.bookletConfigData = done => {
  cliPrint.headline('BookletConfig: Writing Markdown documentation');

  const definition = JSON.parse(fs.readFileSync(`${definitionsDir}/booklet-config.json`).toString());

  const output = [];

  output.push('// this file is automatically generated. do not change anything here directly!');
  output.push('export class BookletConfigData {');

  Object.keys(definition)
    .forEach(configParameter => {
      const line = `  ${configParameter}: ${
        Object.keys(definition[configParameter].options)
          .map(option => `'${option}'`)
          .join(' | ')
      } = '${definition[configParameter].defaultvalue}';`;
      output.push(line);
    });

  output.push('}');
  output.push('');

  fs.writeFileSync(`${commonDir}/src/classes/booklet-config-data.class.ts`, output.join('\n'));
  done();
};

exports.createInterfaces = gulp.series(
  exports.bookletConfigData
);
