<!--<td>-->
<!--    {{testStatus.personId}}|{{testStatus.testId}}-->
<!--</td>-->

<td>
    <div class="vertical-align-middle">
        <ng-container *ngIf="getMode(testStatus.mode) as mode" >

            <mat-icon *ngIf="mode.modeId === 'HOT'">face</mat-icon>
            <mat-icon *ngIf="mode.modeId === 'REVIEW'">rate_review</mat-icon>
            <mat-icon *ngIf="mode.modeId === 'TRIAL'">remove_red_eye</mat-icon>
            <mat-icon *ngIf="mode.modeId === 'DEMO'">ondemand_video</mat-icon>
            <mat-icon *ngIf="mode.modeId === 'monitor-group'">supervisor_account</mat-icon>
            <mat-icon *ngIf="mode.modeId === 'monitor-workspace'">supervisor_account</mat-icon>
            <mat-icon *ngIf="mode.modeId === 'monitor-study'">supervisor_account</mat-icon>
        </ng-container>
        <h1>{{testStatus.personLabel}}</h1>
    </div>
</td>


<!--<td><div class="vertical-align-middle">{{testStatus.groupLabel}}</div></td>-->

<ng-container *ngIf="(booklet$ | async) as booklet; else: noBooklet">

    <td class="booklet">

        <div class="vertical-align-middle">

            <h1>{{booklet.metadata.label}}</h1>

            <mat-icon class="unit-badge"
                      *ngIf="hasState(testStatus.testState, 'status', 'locked')"
                      matTooltip="Testheft gesperrt"
                >lock
            </mat-icon>

            <mat-icon class="unit-badge"
                      *ngIf="!hasState(testStatus.testState, 'status', 'locked')"
                      matTooltip="Testheft gesperrt"
                >lock_open
            </mat-icon>

            <mat-icon class="unit-badge"
                      *ngIf="hasState(testStatus.testState, 'BOOKLETLOCKEDbyTESTEE')"
                      matTooltip="Testheft abgeschlossen"
                >done_all
            </mat-icon>
        </div>
    </td>

    <td *ngIf="booklet.units as testlet">

        <div class="units-container" [class]="hasState(testStatus.testState, 'status', 'locked') ? 'locked' : ''">
            <div class="units">
                <ng-container *ngTemplateOutlet="testletTemplate; context: {$implicit: testlet}"></ng-container>
            </div>
        </div>

        <div class="featured-unit" *ngIf="(featuredUnit$| async) as unitContext; else: noFeaturedUnit">

            <h1>{{unitContext.parent.label || 'Aktueller Abschnitt'}}</h1>

            <mat-icon class="unit-badge"
                      *ngIf="maxTimeLeft && (maxTimeLeft[unitContext.parent.id] !== undefined)"
                      matBadge="{{maxTimeLeft[unitContext.parent.id].toString()}}"
                      matBadgeColor="accent"
                      matTooltip="Verbleibende Zeit"
                >alarm
            </mat-icon>

            <h1>:</h1>

            <h2>{{unitContext.unit.label || unitContext.unit.labelShort || unitContext.unit.id}}</h2>

            <mat-icon class="unit-badge"
                      *ngIf="hasState(testStatus.unitState, 'PRESENTATIONCOMPLETE', 'yes')"
                      matTooltip="Vollständig betrachtet / angehört"
                >remove_red_eye
            </mat-icon>

            <mat-icon class="unit-badge"
                      *ngIf="hasState(testStatus.unitState, 'RESPONSESCOMPLETE', 'all')"
                      matTooltip="Fertig beantwortet"
                >done_all
            </mat-icon>
        </div>
    </td>
</ng-container>

<ng-template #noFeaturedUnit>
</ng-template>

<ng-template #testletTemplate let-testlet>

    <span *ngIf="testlet.restrictions && testlet.restrictions.codeToEnter as codeToEnter"
          class="unit restriction"
          matTooltip="Freigabewort: {{codeToEnter.code.toUpperCase()}}"
          matTooltipPosition="above"
        >
        <mat-icon>sms</mat-icon>
    </span>

    <span *ngIf="testlet.restrictions && testlet.restrictions.lock as lock"
          class="unit restriction"
          matTooltip="{{lock.message}}"
          matTooltipPosition="above"
        >
        <mat-icon>lock</mat-icon>
    </span>

    <ng-container *ngFor="let testletOrUnit of testlet.children; trackBy: trackUnits" [ngSwitch]="getTestletType(testletOrUnit)">

        <span *ngSwitchCase="'unit'"
              [class]="(testStatus.unitName === testletOrUnit.id) ? 'unit current': 'unit'"
              matTooltip="{{testletOrUnit.label}}"
              matTooltipPosition="above"
            >{{testletOrUnit.labelShort || "&nbsp;"}}
        </span>

        <span *ngSwitchCase="'testlet'" class="testlet" matTooltip="{{testletOrUnit.label}}">
            <ng-container *ngTemplateOutlet="testletTemplate; context: {$implicit: testletOrUnit}"></ng-container>
        </span>
        <!--                <pre>{{testletOrUnit|json}}</pre>-->

    </ng-container>
</ng-template>


<ng-template #noBooklet>
    <td colspan="2" class="booklet">Noch kein Test gestarted.</td>
</ng-template>
