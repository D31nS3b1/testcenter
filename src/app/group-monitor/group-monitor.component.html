<div class="page-header">
  <p>IQB-Testcenter Gruppenüberwachung: <span *ngIf="ownGroup$ | async as ownGroup">{{ownGroup.label}}</span></p>
  <span class="fill-remaining-space"></span>
  <p>
    <mat-chip-list *ngIf="connectionStatus$ | async as connectionStatus">

        <mat-chip [class]="connectionStatus + ' connection-status'">
            <mat-icon>
                {{connectionStatus === 'error' ? 'error' : ''}}
                {{connectionStatus === 'polling-fetch' ? 'loop' : ''}}
                {{connectionStatus === 'polling-sleep' ? 'loop' : ''}}
                {{connectionStatus === 'ws-offline' ? 'loop' : ''}}
                {{connectionStatus === 'ws-online' ? 'wifi_tethering' : ''}}
            </mat-icon>
            {{connectionStatus === 'error' ? 'Offline' : ''}}
            {{connectionStatus === 'polling-fetch' ? 'Online' : ''}}
            {{connectionStatus === 'polling-sleep' ? 'Online' : ''}}
            {{connectionStatus === 'ws-offline' ? 'Reconn.' : ''}}
            {{connectionStatus === 'ws-online' ? 'Live' : ''}}
        </mat-chip>
    </mat-chip-list>
  </p>
</div>

<div class="page-body">
  <div class="adminbackground">

      <mat-menu #rootMenu="matMenu">
          <button mat-menu-item [matMenuTriggerFor]="group">Spalten</button>
          <button mat-menu-item [matMenuTriggerFor]="activity">Aktivität</button>
      </mat-menu>

      <mat-menu #group="matMenu">
          <button mat-menu-item (click)="setDisplayOption('groupColumn', (displayOptions.groupColumn === 'hide') ? 'show' : 'hide')">
              <mat-icon *ngIf="displayOptions.groupColumn === 'show'">check</mat-icon>
              <span>Spalte anzeigen</span>
          </button>
      </mat-menu>

      <mat-menu #activity="matMenu">
          <button mat-menu-item (click)="setDisplayOption('view', 'full')">
              <mat-icon *ngIf="displayOptions.view === 'full'">check</mat-icon>
              <span>Vollständig</span>
          </button>
          <button mat-menu-item (click)="setDisplayOption('view', 'medium')">
              <mat-icon *ngIf="displayOptions.view === 'medium'">check</mat-icon>
              <span>Nur Blöcke</span>
          </button>
          <button mat-menu-item (click)="setDisplayOption('view', 'small')">
              <mat-icon *ngIf="displayOptions.view === 'small'">check</mat-icon>
              <span>Kurz</span>
          </button>
      </mat-menu>

      <button class="settings-button" mat-icon-button [matMenuTriggerFor]="rootMenu">
          <mat-icon>settings</mat-icon>
      </button>

      <div class="test-view-table-wrapper">
          <table class="test-view-table" matSort (matSortChange)="setTableSorting($event)">

            <thead>
                <tr class="mat-sort-container">
                    <td mat-sort-header="personLabel">Benutzer</td>
                    <td mat-sort-header="groupLabel" *ngIf="displayOptions.groupColumn === 'show'">Gruppe</td>
                    <td mat-sort-header="bookletName">Testheft</td>
                    <td mat-sort-header="timestamp">Aktivität</td>
                </tr>
            </thead>

            <tc-test-view
                    *ngFor="let session of sessions$ | async; trackBy: trackSession"
                    [testSession]="session"
                    [displayOptions]="displayOptions"
                    (bookletId$)="adjustViewModeOnBookletLoad($event)"
                >
            </tc-test-view>
          </table>
      </div>


    </div>
</div>
