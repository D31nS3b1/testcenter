<div class="page-header">
  <p>IQB-Testcenter Gruppenüberwachung: <span *ngIf="ownGroup$ | async as ownGroup">{{ownGroup.label}}</span></p>
  <span class="fill-remaining-space"></span>
  <p>
    <mat-chip-list *ngIf="connectionStatus$ | async as connectionStatus">

        <mat-chip [class]="connectionStatus + ' connection-status'">
            <mat-icon>
                {{connectionStatus === 'error' ? 'error' : ''}}
                {{connectionStatus === 'polling-fetch' ? 'loop' : ''}}
                {{connectionStatus === 'polling-sleep' ? 'loop' : ''}}
                {{connectionStatus === 'ws-offline' ? 'loop' : ''}}
                {{connectionStatus === 'ws-online' ? 'wifi_tethering' : ''}}
            </mat-icon>
            {{connectionStatus === 'error' ? 'Offline' : ''}}
            {{connectionStatus === 'polling-fetch' ? 'Online' : ''}}
            {{connectionStatus === 'polling-sleep' ? 'Online' : ''}}
            {{connectionStatus === 'ws-offline' ? 'Reconn.' : ''}}
            {{connectionStatus === 'ws-online' ? 'Live' : ''}}
        </mat-chip>
    </mat-chip-list>
  </p>
</div>

<mat-menu #rootMenu="matMenu">
    <button mat-menu-item [matMenuTriggerFor]="group">Spalten</button>
    <button mat-menu-item [matMenuTriggerFor]="activity">Aktivität</button>
</mat-menu>

<mat-menu #group="matMenu">
    <button mat-menu-item (click)="setDisplayOption('groupColumn', (displayOptions.groupColumn === 'hide') ? 'show' : 'hide')">
        <mat-icon *ngIf="displayOptions.groupColumn === 'show'">check</mat-icon>
        <span>Spalte anzeigen</span>
    </button>
</mat-menu>

<mat-menu #activity="matMenu">
    <button mat-menu-item (click)="setDisplayOption('view', 'full')">
        <mat-icon *ngIf="displayOptions.view === 'full'">check</mat-icon>
        <span>Vollständig</span>
    </button>
    <button mat-menu-item (click)="setDisplayOption('view', 'medium')">
        <mat-icon *ngIf="displayOptions.view === 'medium'">check</mat-icon>
        <span>Nur Blöcke</span>
    </button>
    <button mat-menu-item (click)="setDisplayOption('view', 'small')">
        <mat-icon *ngIf="displayOptions.view === 'small'">check</mat-icon>
        <span>Kurz</span>
    </button>
</mat-menu>

<div class="page-body">
    <mat-sidenav-container>
        <mat-sidenav #sidenav mode="side" class="toolbar">
            <div class="toolbar-section">
                Auswahl-Modus:
                <mat-radio-group class="example-radio-group" [(ngModel)]="displayOptions.selectionMode">
                    <mat-radio-button value="block">Block</mat-radio-button>
                    <mat-radio-button value="unit">Aufgabe</mat-radio-button>
                </mat-radio-group>
            </div>

            <hr>

            <div class="selection-info">
                <ng-container *ngIf="selectedElement">
                    Auswahl: Block `{{selectedElement.label}} `
                    in {{selectedSessions.length}} Tests ausgewählt {{allTestsSelected ? ' (alle)' : ''}}.
                </ng-container>
            </div>

            <hr>

            <button mat-raised-button class="control" color="primary" (click)="testCommandResume()" [disabled]="!selectedSessions.length">
                <mat-icon>play_arrow</mat-icon>WEITER
            </button>

            <button mat-raised-button class="control" color="primary" (click)="testCommandPause()" [disabled]="!selectedSessions.length">
                <mat-icon>pause</mat-icon>PAUSE
            </button>

            <button mat-raised-button class="control" color="primary" (click)="testCommandGoto()" [disabled]="!selectedElement">
                <mat-icon>arrow_forward</mat-icon>SPRINGE ZU <span class="emph">{{selectedElement?.label}}</span>
            </button>

        </mat-sidenav>

        <mat-sidenav-content>

            <div class="adminbackground">

                <button class="settings-button" mat-icon-button [matMenuTriggerFor]="rootMenu">
                    <mat-icon>settings</mat-icon>
                </button>

                <button class="drawer-button" mat-icon-button (click)="sidenav.toggle()">
                    <mat-icon>menu_open</mat-icon>
                </button>

                <div class="test-view-table-wrapper">
                    <table class="test-view-table" matSort (matSortChange)="setTableSorting($event)">

                        <thead>
                        <tr class="mat-sort-container">
                            <td mat-sort-header="selected">
                                <mat-checkbox (change)="selectAll($event)" [checked]="allTestsSelected"></mat-checkbox>
                            </td>
                            <td mat-sort-header="personLabel">Benutzer</td>
                            <td mat-sort-header="groupLabel" *ngIf="displayOptions.groupColumn === 'show'">Gruppe</td>
                            <td mat-sort-header="bookletName">Testheft</td>
                            <td mat-sort-header="timestamp">Aktivität</td>
                        </tr>
                        </thead>

                        <ng-container *ngFor="let session of sessions$ | async; trackBy: trackSession">

                            <td>
                                <mat-checkbox
                                        *ngIf="session.testId >= 0"
                                        (change)="selectSession($event, session)"
                                        [checked]="selectedSessions.indexOf(session) > -1"
                                >
                                </mat-checkbox>
                            </td>

                            <tc-test-view
                                [testSession]="session"
                                [displayOptions]="displayOptions"
                                [markedElement]="markedElement"
                                (markedElement$)="markElement($event)"
                                [selectedElement]="selectedElement"
                                (selectedElement$)="selectElement($event)"
                                (bookletId$)="adjustViewModeOnBookletLoad($event)"
                            >
                            </tc-test-view>

                        </ng-container>
                    </table>
                </div>
            </div>

        </mat-sidenav-content>

    </mat-sidenav-container>


</div>
